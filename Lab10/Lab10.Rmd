---
title: "Lab 10"
author: "STAT 359 Data Visualization"
output: html_document
---

# Overview

The goal of this lab is to continue learning data wranging (a skill which is REQUIRED for real-life analysis and data visualization) and continue combining the data visualization components which have been introduced over the previous weeks. This lab, in contrast to the previous two, will add the `gather()` function as it will be useful in creating data sets which can be easily visualized.

# Datasets

The `vgsales.csv` files are from Kaggle (https://www.kaggle.com/gregorut/videogamesales).

Per the website:

This dataset contains a list of video games with sales greater than 100,000 copies. It was generated by a scrape of vgchartz.com.

* `Rank` - Sales rank
* `Name` - Name of the game
* `Platform` -  Release platform for the game
* `Year` - Year of the release
* `Genre` - Game genre
* `Publisher` - Company which released the game
* `NA_Sales` - North American sales
* `EU_Sales` - European sales
* `JP_Sales` - Japanese sales
* `Other_Sales` - Sales countries other than North America, Europe, and Japan
* `Global_Sales` - Sales from all coutries

# Task

Run the provided R code, just below, prior to completing the tasks.

Note: Appropriate styling and labeling is REQUIRED (where APPROPRIATE... remember, this is subjective).

```{r, message=FALSE, warning=FALSE}
# Import libraries
library(tidyverse)
library(ggthemes)

# Import data
videogame_sales_data <- read_csv('vgsales.csv')

glimpse(videogame_sales_data)
```

<br>

0a. How many distinct platforms are there in the data? (hint: use Google. There is a function just for this.)

```{r, message=FALSE, warning=FALSE}
n_distinct(videogame_sales_data$Platform)
```

<br>

0b. Are Global_Sales the sum of `NA_Sales`, `EU_Sales`, `JP_Sales`, and `Other Sales`? Prove it. (hint: there are many ways to accomplish this and the amounts may be off due to rounding error... one way uses `near()`, another uses `mutate()`, `select()`, and `unique()` functions, among others...)

```{r, message=FALSE, warning=FALSE}
videogame_sales_data %>% 
  mutate(Global_Sales_Test = NA_Sales + EU_Sales + JP_Sales + Other_Sales,
         isSame = abs(Global_Sales_Test - Global_Sales) < .5) %>% 
  select(isSame) %>% 
  unique()

# OR

videogame_sales_data %>% 
  mutate(Global_Sales_Test = NA_Sales + EU_Sales + JP_Sales + Other_Sales,
         isSame = near(Global_Sales_Test, Global_Sales, .05)) %>% 
  select(isSame) %>% 
  unique()
```

<br>

1a. Recreate this plot. (hint: it uses `theme_hc()`)

```{r, message=FALSE, warning=FALSE}
sales_count_data <- filter(videogame_sales_data, Year >= 2005)

ggplot(sales_count_data, aes(Year)) +
  geom_bar() +
  theme_hc() +
  labs(y = 'Number of Observations')
```

<br>

1b. Is there anything on this visualization which would make you supicious (hint: there is)? What is it? 

`1. 2020 hasn't happened yet... but, maybe these are pre-sales?`
`2. Lots of NA values... what should we do with them (in real life: speak to a domain expert)?`
`3. Not sure all sales are fully account in the most recent years (again: speak to a domain expert)`

<br>

2a. What's wrong with the below dataframe? Fix it.

```{r}
(videogame_sales_data2 <- videogame_sales_data %>% 
  gather(NA_Sales, EU_Sales, JP_Sales, Other_Sales, Global_Sales))
```

```{r, message=FALSE, warning=FALSE}
(videogame_sales_data2 <- videogame_sales_data %>% 
  gather(NA_Sales, EU_Sales, JP_Sales, Other_Sales, Global_Sales, key = 'Region', value = 'Sales'))
```

<br>

2b. Convert the new column contain the different sales regions into a factor variable.

```{r, message=FALSE, warning=FALSE}
videogame_sales_data2 <- videogame_sales_data2 %>% 
  mutate(Region = factor(Region))
```

<br>

3. Observe the below [bad] visualization using geom_boxplot and display the single largest offending outlier.

```{r}
ggplot(videogame_sales_data2, aes(Region, Sales)) +
  geom_boxplot() +
  theme_tufte()
```

```{r, message=FALSE, warning=FALSE}
filter(videogame_sales_data2, Sales > 80)
```

<br>

4. Recreate the below visualization. (hint: the theme is grey)

```{r, message=FALSE, warning=FALSE}
Nintendo_Activision_data <- filter(videogame_sales_data2, Publisher %in% c('Nintendo', 'Activision'),
                                   Region != 'Global_Sales')

ggplot(Nintendo_Activision_data, aes(Region, Sales, fill = Publisher)) +
  geom_bar(stat = 'identity') +
  theme_grey() +
  labs(title = 'Total Sales by Region') +
  theme(legend.position = 'bottom')
```

5. Recreate the below visualization. (hint: the theme is light)

```{r, message=FALSE, warning=FALSE}
year2016_data <- (filter(videogame_sales_data, Year == 2016))

ggplot(year2016_data, aes(NA_Sales, EU_Sales, label = Name, color = Platform)) +
  geom_text(check_overlap = TRUE, vjust = 'inward', hjust = 'inward') +
  facet_wrap(~ Genre) +
  scale_y_log10() +
  scale_x_log10() +
  theme_light()
```